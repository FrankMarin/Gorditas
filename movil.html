<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Calculadora Natalia</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Customized Bootstrap Stylesheet -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="css/style.css" rel="stylesheet">
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
            <div class="spinner-grow text-primary" role="status"></div>
        </div>
        <!-- Spinner End -->


        <!-- Navbar start -->
        <div class="container-fluid fixed-top">
            <div class="container topbar bg-primary d-none d-lg-block">
                <div class="d-flex justify-content-between">
                    <div class="top-info ps-2">
                        <small class="me-3"><i class="fas fa-map-marker-alt me-2 text-secondary"></i> <a href="#" class="text-white">Fidel Velazquez</a></small>
                        <small class="me-3"><i class="fas fa-envelope me-2 text-secondary"></i><a href="#" class="text-white">frank@gorditas-natalia.com</a></small>
                    </div>
                </div>
            </div>
        </div>
        <!-- Navbar End -->


        <!-- Cart Page Start -->
        <div class="container-fluid">
            <div class="container py-2">
                <div class="row g-5">
                    <div class="col-md-6 col-lg-6 col-xl-7">
                        <div id="lista-guisados" class="row g-2 justify-content-center">
                            <div class="col-md-3 col-lg-3 col-xl-3">
                                <div class="rounded position-relative fruite-item" onclick="addGuisado('chicharron')">
                                    <div class="fruite-img">
                                        <img src="img/pella.jpg" class="img-fluid w-100 rounded-top" alt="">
                                    </div>
                                    <div class="text-white px-1 py-1 rounded position-absolute" style="top: 32px; left: 28px; font-size: small;">$25.00</div>
                                    <div class="p-1 border border-secondary border-top-0 rounded-bottom">
                                        <h6>Pella</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3 col-xl-3">
                                <div class="rounded position-relative fruite-item" onclick="addGuisado('chicharron')">
                                    <div class="fruite-img">
                                        <img src="img/pella.jpg" class="img-fluid w-100 rounded-top" alt="">
                                    </div>
                                    <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">$25.00</div>
                                    <div class="guisados p-2 border border-secondary border-top-0 rounded-bottom">
                                        <h6>Pella</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3 col-xl-3">
                                <div class="rounded position-relative fruite-item" onclick="addGuisado('chicharron')">
                                    <div class="fruite-img">
                                        <img src="img/pella.jpg" class="img-fluid w-100 rounded-top" alt="">
                                    </div>
                                    <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">$25.00</div>
                                    <div class="guisados p-2 border border-secondary border-top-0 rounded-bottom">
                                        <h6>Pella</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3 col-xl-3">
                                <div class="rounded position-relative fruite-item" onclick="addGuisado('chicharron')">
                                    <div class="fruite-img">
                                        <img src="img/pella.jpg" class="img-fluid w-100 rounded-top" alt="">
                                    </div>
                                    <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">$25.00</div>
                                    <div class="guisados p-2 border border-secondary border-top-0 rounded-bottom">
                                        <h6>Pella</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-5">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                  <tr>
                                    <th scope="col">Guisado</th>
                                    <th scope="col">Precio</th>
                                    <th scope="col">Cantidad</th>
                                    <th scope="col">Total</th>
                                  </tr>
                                </thead>
                                <tbody id="lista-pedido">
                                    
                                </tbody>
                            </table>
                        </div>
                        <div class="row g-4 justify-content-end">
                            <div class="bg-light rounded">
                                <div class="p-2">
                                    <h4><span id="numero-pedido" class="fw-normal"></span></h4>
                                </div>
                                <div class="py-4 mb-4 border-top border-bottom d-flex justify-content-between">
                                    <h2 class="mb-0 ps-4 me-4">Total</h2>
                                    <h1 id="gran-total" class="mb-0 pe-4"></h1>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn border-secondary rounded-pill px-4 py-3 text-primary mb-4 ms-4" type="button" onclick="nuevoPedido()">Nuevo Pedido</button>
            <button class="btn border-secondary rounded-pill px-4 py-3 text-primary mb-4 ms-4" type="button" onclick="imprimirComanda()">Imprimir</button>
        <!-- Cart Page End -->

        <!-- Copyright Start -->
        <div class="container-fluid copyright bg-dark py-4">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        <span class="text-light"><a href="#"><i class="fas fa-copyright text-light me-2"></i>Gorditas Natalia</a>, All right reserved.</span>
                    </div>
                    <div class="col-md-6 my-auto text-center text-md-end text-white">
                        Designed By <a class="border-bottom" href="https://gorditas.com">Frank Marin</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Copyright End -->

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- Gorditas Propietary Code -->
    <script>
    var numeroPedido = 1;
    var pedido = [];
    var productos = [
      { nombre: 'Pella', precio: 30.00 },
      { nombre: 'Asado', precio: 30.00 },
      { nombre: 'Arriero', precio: 30.00 },
      { nombre: 'Verde', precio: 30.00 },
      { nombre: 'Rojo', precio: 30.00 },
      { nombre: 'Salchicha', precio: 30.00 },
      { nombre: 'Papas', precio: 25.00 },
      { nombre: 'Barbacoa', precio: 50.00 }
    ];

    function generarLista() {
      var listaHTML = '';
      productos.forEach(function(producto) {
        listaHTML += '<div class="col-md-3 col-lg-3 col-xl-3"> <div class="rounded position-relative fruite-item" onclick="addGuisado(' + "'" + producto.nombre + "'" +')"> <div class="fruite-img">'
        listaHTML += '<img src="img/' + producto.nombre + '.jpg" class="img-fluid w-100 rounded-top" alt=""></div>'
        listaHTML += '<div class="text-white px-1 py-1 rounded position-absolute" style="top: 36px; left: 38px; font-size: small;">$' + producto.precio + '</div>';
        listaHTML += '<div class="p-1 border border-secondary border-top-0 rounded-bottom"> <h6>' + producto.nombre + '</h6> </div> </div> </div>';
      });
      document.getElementById('lista-guisados').innerHTML = listaHTML;
    }

    function searchGuisado(guisado) {
      for (var i = 0; i < productos.length; i++) {
        if (productos[i].nombre === guisado) {
          return productos[i];
        }
      }
      return null;
    }

    function searchGuisadoEnPedido(guisado) {
      for (var i = 0; i < pedido.length; i++) {
        if (pedido[i].nombre === guisado) {
          return pedido[i];
        }
      }
      return null;
    }

    function addGuisado(guisado) {
        var guisadoBuscado = searchGuisado(guisado);
        var guisadoEnPedido = searchGuisadoEnPedido(guisado);
        if (guisadoEnPedido === null) {
            pedido.push({nombre: guisado, precio: guisadoBuscado.precio, cantidad: 1, total: guisadoBuscado.precio});
        } else {
            guisadoEnPedido.cantidad = guisadoEnPedido.cantidad + 1;
            guisadoEnPedido.total = guisadoEnPedido.precio * guisadoEnPedido.cantidad;
        }
        actualizaPedido();
    }

    function removeGuisado(guisado) {
    var nuevoPedido = [];
    for (var i = 0; i < pedido.length; i++) {
        if (pedido[i].nombre != guisado) {
        nuevoPedido.push(pedido[i]);
        }
      }

      return nuevoPedido;
    }

    function editarPedido(cantidad, guisado) {
        var guisadoEnPedido = searchGuisadoEnPedido(guisado);
        if (guisadoEnPedido != null) {
            nuevaCatidad = guisadoEnPedido.cantidad + cantidad;
            console.log(nuevaCatidad);
            if (nuevaCatidad == 0) {
                pedido = removeGuisado(guisadoEnPedido.nombre);
            } else {
                guisadoEnPedido.cantidad = guisadoEnPedido.cantidad + cantidad;
                guisadoEnPedido.total = guisadoEnPedido.precio * guisadoEnPedido.cantidad;
            }
        }
        actualizaPedido();
    }

    function actualizaPedido() {
        var listaHTML = '';
        var granTotal = 0;
        if (pedido.length > 0) {
            pedido.forEach(function(producto) {
            listaHTML += '<tr> <td> <p class="mb-0">' + producto.nombre + '</p> </td>';
            listaHTML += '<td> <p class="mb-0">'  + producto.precio + '</p> </td>';
            listaHTML += '<td> <div class="input-group quantity" style="width: 100px;"> <div class="input-group-btn">';
            listaHTML += '<button class="btn btn-sm btn-minus rounded-circle bg-light border" onclick="editarPedido(-1,'+ "'" + producto.nombre + "'" +')"> <i class="fa fa-minus"></i> </button> </div>';
            listaHTML += '<input type="text" class="form-control form-control-sm text-center border-0" value="' + producto.cantidad + '">';
            listaHTML += '<div class="input-group-btn"> <button class="btn btn-sm btn-plus rounded-circle bg-light border" onclick="editarPedido(1,'+ "'" + producto.nombre + "'" +')"> <i class="fa fa-plus"></i> </button> </div>';
            listaHTML += '</div> </td> <td> <p class="mb-0">'+ producto.total +'</p> </td> </tr>';
            granTotal = granTotal + producto.total;
        });
        }
        
      document.getElementById('lista-pedido').innerHTML = listaHTML;
      document.getElementById('gran-total').innerHTML = '$' + granTotal;
      document.getElementById('numero-pedido').innerHTML = 'Pedido# ' + numeroPedido;
    }

    function nuevoPedido() {
        pedido = [];
        numeroPedido = numeroPedido + 1;
        localStorage.setItem("numeroPedido", numeroPedido);

        actualizaPedido();
    }

    function imprimirComanda() {
        var granTotal = 0;
        if (pedido.length > 0) {
            var comanda = '<h2> Comanda # ' + numeroPedido + '</h2>';
            pedido.forEach(function(producto) {
                comanda += '<p>' + producto.cantidad + ' / ' + producto.nombre + '</p>';
            granTotal = granTotal + producto.total;
        });
        comanda += '<h2> Total $' + granTotal + '</h2>';
        }

        var ventanaImpresion = window.open('', '_blank');
        ventanaImpresion.document.open();
        ventanaImpresion.document.write(comanda);
        ventanaImpresion.document.close();
        ventanaImpresion.print();

        nuevoPedido();
    }

    window.onload = function() {
        generarLista();
        numeroPedido = localStorage.getItem("numeroPedido");
    };
    </script>
    </body>

</html>